version: "2"

services:
  registry:
    build: registry
    volumes:
    - "${REGISTRY_HOME}:/var/lib/registry/"
    - "${HTPASSWD_HOME}:/auth/"
    expose:
    - 5000
    environment:
    - REGISTRY_AUTH=htpasswd
    - REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd
    - REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm
    - REGISTRY_STORAGE_DELETE_ENABLED=true
    networks:
      registry_default:
        aliases: 
        - registry-srv
    restart: "unless-stopped"

  nginx:
    build: nginx
    ports:
    - "5043:443"
    - "5044:444"
    volumes:
    - ${REGISTRY_SSL_CERT_PATH}:/etc/nginx/ssl/cert.pem
    - ${REGISTRY_SSL_KEY_PATH}:/etc/nginx/ssl/privkey.pem
    depends_on:
    - registry
    restart: "unless-stopped"

networks:
  registry_default:
    external: false